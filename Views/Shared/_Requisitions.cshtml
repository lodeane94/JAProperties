@model List<SS.ViewModels.RequisitionViewModel>

<section class="management-action-content">
    <section class="management-action-section req">
        <div class="dashboard-info msg-container req">
            <div id="dashboard-requisitions" class="table-responsive">
                <table id="tblRequisitions" width="100%">
                    @{
                        int notAcceptedCount = 0;//keeps count of the accepted requisitions
                                                 // bool hasHistory = false;
                        int headerCount = 0;

                        if (Model != null)
                        {
                            foreach (var req in Model)
                            {
                                if (req.PropertyRequisition.IsAccepted.HasValue && !req.PropertyRequisition.IsAccepted.Value)
                                {
                                    headerCount++;
                                    notAcceptedCount++;
                                    //display header only once
                                    if (headerCount < 2)
                                    {
                                        <thead>
                                            <tr>
                                                <th>Property Image</th>
                                                <th>First Name</th>
                                                <th>Last Name</th>
                                                @if (req.isUserPropOwner)
                                                {
                                                    <th>Email</th>
                                                }
                                                <th>Cell</th>
                                                <th>Date</th>
                                                <th>&nbsp;</th>
                                                <th>&nbsp;</th>
                                            </tr>
                                        </thead>
                                        <input id="isUserPropOwner" type="hidden" value="@Html.Raw(req.isUserPropOwner)" />
                                        
                                    }
                                    <tr>
                                        <td class="property_image"><img style="width:100px;height:100px;" src="~/Uploads/@req.ImageUrl" /></td>
                                        <td class="first_name"> @req.PropertyRequisition.User.FirstName</td>
                                        <td class="last_name"> @req.PropertyRequisition.User.LastName</td>
                                        @if (req.isUserPropOwner)
                                        {
                                            <td class="email"> @req.PropertyRequisition.User.Email</td>
                                        }
                                        <td class="cell"> @req.PropertyRequisition.User.CellNum</td>
                                        <td class="date"> @req.PropertyRequisition.DateTCreated</td>
                                        @if (req.isUserPropOwner)
                                        {
                                            <td><input id="@req.PropertyRequisition.ID" class="btnAcceptRequest btn btn-accent" type="button" value="Accept"></td>
                                            <td><input id="@req.PropertyRequisition.ID" class="btnDenyRequest btn btn-accent" type="button" value="Deny"></td>
                                        }
                                        else
                                        {
                                            <td><em>Awaiting response ...</em></td>
                                            <td><input id="@req.PropertyRequisition.ID" class="btnDenyRequest btn btn-accent" type="button" value="Cancel"></td>
                                        }
                                    </tr>
                                    if (req.PropertyRequisition.Msg != null)
                                    {
                                        <tr>
                                            <td colspan="10"><div class="contact-info-header" style="overflow:auto;">@req.PropertyRequisition.Msg</div></td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    //hasHistory = true;
                                }
                            }
                            if (Model != null && notAcceptedCount < 1)
                            {
                                <tr><td class="contact-info-content" colspan="8"><center>No Requisition Records Found</center></td></tr>
                            }
                        }
                    }
                </table>
            </div>
        </div>
    </section>
</section>
